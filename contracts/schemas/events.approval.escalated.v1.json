{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.demon.ai/events/approval.escalated.v1.json",
  "title": "Approval Escalated Event",
  "description": "Event emitted when an approval request is escalated to the next level",
  "type": "object",
  "properties": {
    "event": {
      "type": "string",
      "const": "approval.escalated:v1"
    },
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the event"
    },
    "tenantId": {
      "type": "string",
      "description": "Tenant identifier"
    },
    "runId": {
      "type": "string",
      "description": "Unique identifier for the ritual run"
    },
    "ritualId": {
      "type": "string",
      "description": "Identifier of the ritual"
    },
    "gateId": {
      "type": "string",
      "description": "Identifier of the approval gate"
    },
    "fromLevel": {
      "type": "integer",
      "minimum": 1,
      "description": "Level escalated from"
    },
    "toLevel": {
      "type": "integer",
      "minimum": 1,
      "description": "Level escalated to"
    },
    "reason": {
      "type": "string",
      "description": "Reason for escalation (e.g., 'timeout', 'manual')"
    },
    "escalationState": {
      "type": "object",
      "description": "Current escalation state",
      "properties": {
        "currentLevel": {
          "type": "integer",
          "minimum": 1
        },
        "totalLevels": {
          "type": "integer",
          "minimum": 1
        },
        "levelStartedAt": {
          "type": "string",
          "format": "date-time"
        },
        "nextEscalationAt": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "emergencyOverride": {
          "type": "boolean"
        }
      },
      "required": ["currentLevel", "totalLevels", "levelStartedAt", "emergencyOverride"],
      "additionalProperties": false
    }
  },
  "required": [
    "event",
    "ts",
    "tenantId",
    "runId",
    "ritualId",
    "gateId",
    "fromLevel",
    "toLevel",
    "reason",
    "escalationState"
  ],
  "additionalProperties": false
}