# Example Kubernetes Bootstrap Configuration
# This file demonstrates how to configure a Demon Kubernetes deployment

apiVersion: demon.io/v1
kind: BootstrapConfig
metadata:
  name: my-demon-cluster

# Kubernetes cluster configuration
cluster:
  name: my-k3s-cluster
  runtime: k3s
  k3s:
    version: "v1.28.2+k3s1"  # K3s version to install
    install:
      channel: stable
      disable: []
    dataDir: /var/lib/rancher/k3s  # K3s data directory
    nodeName: demon-node-1  # Name for the cluster node
    extraArgs:
      - "--disable=traefik"  # Disable default traefik ingress
      - "--disable=servicelb"  # Disable service load balancer

# Demon system configuration
demon:
  # NATS connection settings
  natsUrl: "nats://nats.demon-system.svc.cluster.local:4222"
  streamName: "RITUAL_EVENTS"
  subjects:
    - "ritual.>"
    - "approval.>"
  dedupeWindowSecs: 60

  # UI configuration
  uiUrl: "http://operate-ui.demon-system.svc.cluster.local:3000"

  # Kubernetes namespace for Demon components
  namespace: demon-system

  # Persistent storage configuration
  persistence:
    enabled: true
    storageClass: local-path  # Default k3s storage class
    size: 10Gi

  # Optional: use a pre-built bundle for advanced configuration
  # bundle: "lib://demon-stack/v1.0.0"

# Secret management configuration
secrets:
  provider: env  # Options: 'env' or 'vault'

  # Environment variable provider configuration
  # Maps secret keys (as they'll appear in the K8s Secret) to environment variable names
  env:
    github_token: GITHUB_TOKEN         # Will read from $GITHUB_TOKEN env var
    admin_token: ADMIN_TOKEN           # Will read from $ADMIN_TOKEN env var
    database_url: DATABASE_URL         # Will read from $DATABASE_URL env var
    nats_password: NATS_PASSWORD       # Will read from $NATS_PASSWORD env var
    jwt_secret: JWT_SECRET             # Will read from $JWT_SECRET env var

  # Vault provider configuration (uncomment and configure if using vault)
  # vault:
  #   address: "https://vault.example.com:8200"  # Optional, defaults to $VAULT_ADDR
  #   role: "demon-bootstrap"                    # Optional, for Kubernetes auth
  #   path: "secret/demon/config"                # Path to secrets in Vault
  #   authMethod: "token"                        # Options: 'token' (default), 'kubernetes'
  # Note: When using token auth, set VAULT_TOKEN environment variable

# Optional add-ons (commented out examples)
addons:
  - name: prometheus
    enabled: false
    values:
      retention: 7d
      storage: 5Gi

  - name: grafana
    enabled: false
    values:
      adminPassword: "admin123"
      persistence:
        enabled: true
        size: 1Gi

# Networking configuration
networking:
  # Ingress configuration (optional)
  ingress:
    enabled: false
    hostname: demon.local
    tlsSecretName: demon-tls

  # Service mesh configuration (optional)
  serviceMesh:
    enabled: false

